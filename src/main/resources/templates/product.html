<!DOCTYPE html>
<html>
<head>
    <title>Product Form</title>
</head>
<body>
<h1 id="formTitle">Add Product</h1>
<form id="productForm">
    <input type="hidden" id="productId">
    Name: <input type="text" id="name" required><br><br>
    Price: <input type="number" id="price" required><br><br>
    <button type="submit">Save</button>
    <button type="button" onclick="location.href='/products'">Cancel</button>
</form>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');

    if (productId) {
        document.getElementById('formTitle').innerText = 'Edit Product';
        fetch(`/api/products/${productId}`)
            .then(res => res.json())
            .then(p => {
                document.getElementById('productId').value = p.id;
                document.getElementById('name').value = p.name;
                document.getElementById('price').value = p.price;
            });
    }

    document.getElementById('productForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const id = document.getElementById('productId').value;
        const method = id ? 'PUT' : 'POST';
        const url = id ? `/api/products/${id}` : '/api/products';
        const body = JSON.stringify({
            name: document.getElementById('name').value,
            price: document.getElementById('price').value
        });

        fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: body
        }).then(() => location.href = '/products');
    });
</script>
</body>
</html>